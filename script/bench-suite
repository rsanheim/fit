#!/usr/bin/env bash
source "$(dirname "$0")/lib.sh"

[[ "${1:-}" == "-h" || "${1:-}" == "--help" ]] && {
    show_help "bench-suite" "Run full benchmark suite with markdown output" \
        "bench-suite

Runs head-to-head comparisons and scaling tests for all implementations.
Output is markdown-formatted, suitable for piping to a file:

  bench-suite > docs/benchmark-results.md"
    exit 0
}

echo "# Benchmark Results - $(date '+%Y-%m-%d')"
echo
echo "## Environment"
echo
echo "* $(uname -s) $(uname -r)"
echo "* $(sysctl -n hw.ncpu 2>/dev/null || nproc) CPU cores"
echo "* Implementations: $(discover_impl_names | tr '\n' ' ')"
echo

for cmd in status fetch; do
    echo "## $cmd - Head to Head"
    echo
    echo '```'
    "$SCRIPT_DIR/bench-all" "$cmd" 8 2>&1
    echo '```'
    echo
done

echo "## Worker Scaling (status)"
echo
for impl in $(discover_impl_names); do
    echo "### nit-${impl}"
    echo
    echo '```'
    "$SCRIPT_DIR/bench-scaling" "$impl" status "1,2,4,8" 2>&1
    echo '```'
    echo
done
